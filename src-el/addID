#! /usr/bin/env python
# __author__ = "Parisa Kianmajd"
#__version__ = "1.0.1"

import csv
import taxon_dictionary
import sys
            
data = {} # a nested dictionary to store the taxonomies

inputData = csv.DictReader(sys.stdin) 
try:
    for row in inputData:
        author = row["Author"]
        rank = row["Rank"]
        if author not in data:
            data[author] = {}
        if rank not in data[author]:
            data[author][rank] = []
        data[author][rank].append(row["Name"])
except ValueError, e:
    print "Error in the input file:", e
        
with sys.stdout as oFile:
    writer = csv.writer(oFile)
    writer.writerow(["ID", "Name", "Author", "Rank"]) 
# Assign identifiers to each entity
    j = 0
    # group elements based on author column
    for author, value in data.iteritems():
        j += 1
        i = 1
        numRanks = []
        # mapp ranks to numerical value using taxon_dictionary
        for rank in value.keys():
            numRanks.append(taxon_dictionary.rank2num.get(rank,(0,0))[0])
        for rank in [k[0] for k in sorted(zip(value.keys(), numRanks), key=lambda l: l[1] ) ]:
            for name in sorted(value[rank]):
                writer.writerow((str(j) + "." + str(taxon_dictionary.rank2num.get(rank,(0,0))[1]) + str(i), name, author, rank))
                i += 1